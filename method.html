<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script>
        'use strict';
        // 强记:在一个对象中绑定的函数，称为这个对象的方法。
        var xiaoming = {
            name: '小明',
            birth: 1990,
            age: function () {
                var y = new Date().getFullYear();
                return y - this.birth;
            }
        };

        xiaoming.age; // function xiaoming.age()
        var age = xiaoming.age(); // 今年调用是25,明年调用就变成26了
        console.log(age);
        // 强记:[在一个方法内部，this始终指向当前对象]，也就是xiaoming这个变量。10
        // 所以，this.birth可以拿到xiaoming的birth属性。

        // ---------------------------------------------------------------------------------------------
        // this高级知识
        // 强记:在单独调用函数时,this指向调用该函数的对象。
        function getAge() {
            var y = new Date().getFullYear();
            return y - this.birth;
        }

        var xiaoming = {
            name: '小明',
            birth: 1990,
            age: getAge
        };

        xiaoming.age(); // 25, 正常结果
        console.log("全局的this:" + getAge()); // NaN; strict模式下,会报TypeError异常。
        // 更坑爹的是，如果这么写：
        var fn = xiaoming.age; // 先拿到xiaoming的age函数
        fn(); // NaN
        // 也是不行的！要保证this指向正确，必须用obj.xxx()的形式调用！
        // 由于这是一个巨大的设计错误，要想纠正可没那么简单。
        // [强记:ECMA决定，在strict模式下让函数的this指向undefined]，因此，在strict模式下，你会得到一个错误：
        // Uncaught TypeError: Cannot read property 'birth' of undefined

        // 有时,你喜欢把方法重构一下。这时我们用一个that变量首先捕获this：
        // 用var that = this;，你就可以放心地在方法内部定义其他函数，而不是把所有语句都堆到一个方法中。
        var xiaoming = {
            name: '小明',
            birth: 1990,
            age: function () {
                var that = this; // 在方法内部一开始就捕获this
                function getAgeFromBirth() {
                    var y = new Date().getFullYear();
                    return y - that.birth; // 用that而不是this
                }
                return getAgeFromBirth();
            }
        };

        console.log(xiaoming.age()); // 25
    </script>
</head>
<body>

</body>
</html>

